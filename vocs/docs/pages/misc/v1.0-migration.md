---
description: Foundry v1.0으로의 업그레이드를 위한 마이그레이션 가이드로, 주요 변경 사항, 더 이상 사용되지 않는 기능, 업데이트된 모범 사례를 포함합니다.
---

## Foundry v1.0 마이그레이션 가이드

Foundry `v1.0` 버전에는 몇 가지 주요 변경 사항(breaking changes)이 도입되었으며, 이전 버전을 사용하는 프로젝트는 업데이트가 필요할 수 있습니다.
이 가이드는 이전 버전에서 마이그레이션할 때 권장되는 모범 사례를 문서화합니다.

- [Foundry v1.0 마이그레이션 가이드](#foundry-v10-migration-guide)
  - [기본적으로 Solc 최적화 비활성화됨](#solc-optimizer-disabled-by-default)
  - [내부 호출에서 expect revert 치트코드가 기본적으로 비활성화됨](#expect-revert-cheatcode-disabled-on-internal-calls-by-default)
  - [testFail 테스트 지원 제거](#removed-support-for-testfail-tests)
  - [레거시 console.sol 서명 지원 제거](#removed-support-for-legacy-consolesol-signatures)
  - [충돌하는 리매핑 무시](#conflicting-remappings-are-ignored)
  - [`forge coverage`에서 아티팩트가 유지되지 않음](#artifacts-not-persisted-on-forge-coverage)
  - [기타](#other)

### 기본적으로 Solc 최적화 비활성화됨 (Solc optimizer disabled by default)

기본적으로 최적화 도구를 활성화하면 겉보기에 올바른 코드에 버그가 발생할 수 있습니다(최적화 도구 자체에 버그가 있는 경우) - [#2486](https://github.com/foundry-rs/foundry/issues/2486) 참조. Foundry `v1.0` 기본 설정은 더 큰 컨트랙트 크기를 보고하거나 프로젝트 빌드 실패를 일으켜 현재 프로젝트에 영향을 줄 수 있습니다. `foundry.toml` 설정에서 최적화 도구와 실행 횟수(runs)를 명시적으로 활성화하는 것이 좋습니다:

```toml
optimizer = true
optimizer_runs = 200
```

> ℹ️ **참고**
>
> 최적화 도구 실행 횟수가 설정된 추가 컴파일러 프로필을 사용하지만 최적화 도구를 명시적으로 활성화하지 않은 프로젝트는 `Missing profile satisfying settings restrictions` 메시지와 함께 빌드에 실패할 수 있습니다.

참조: [optimizer 설정](/config/reference/solidity-compiler#optimizer)

### 내부 호출에서 expect revert 치트코드가 기본적으로 비활성화됨 (Expect revert cheatcode disabled on internal calls by default)

`vm.expectRevert` 치트코드로 내부 함수를 테스트할 때, 동일한 호출 깊이에서 첫 번째 `vm.expectRevert`만 실행됩니다 - [#3437](https://github.com/foundry-rs/foundry/issues/3437) 참조. Foundry `v1.0` 기본 설정에서 이 동작은 기본적으로 비활성화되어 있습니다. 이는 `[FAIL: call didn't revert at a lower depth than cheatcode call depth]`로 테스트 실패를 보고하여 현재 프로젝트에 영향을 줄 수 있습니다. 실패하는 테스트를 검토하고 내부 호출에 대해 revert를 활성화하거나 이를 피하기 위해 테스트를 다시 작성하는 것이 좋습니다.
예를 들어, 아래와 같은 테스트:

```solidity
contract ContractTest is Test {
    error CustomError();

    function revertWithCustomError() internal {
        revert CustomError();
    }

    function testExample() public {
        vm.expectRevert();
        revertWithCustomError();
    }
}
```

공개 함수를 노출하는 모의 `CustomContract`를 사용하도록 변경할 수 있습니다:

```solidity
contract CustomContract {
    error CustomError();

    function revertWithCustomError() external {
        revert CustomError();
    }
}

contract ContractTest is Test {
    CustomContract internal c;

    function setUp() public {
        c = new CustomContract();
    }

    function testExample() public {
        vm.expectRevert();
        c.revertWithCustomError();
    }
}
```

또는 expect reverts를 허용하도록 구성할 수 있습니다:

```solidity
    /// forge-config: default.allow_internal_expect_revert = true
    function testExample() public {
        vm.expectRevert();
        revertWithCustomError();
    }
```

참조: [`vm.expectRevert`](/reference/cheatcodes/expect-revert#error) 치트코드

### testFail 테스트 지원 제거 (Removed support for testFail tests)

`testFail` 테스트 접두사 지원은 혼란을 방지하기 위해 Foundry `v1.0`에서 제거되었습니다 - [#4437](https://github.com/foundry-rs/foundry/issues/4437) 참조. 이는 예상치 못한 곳에서 테스트 실패를 보고하여 기존 프로젝트에 영향을 줄 수 있습니다. 기존 `testFail` 테스트는 `vm.expectRevert()` 치트코드를 사용하거나 `try/catch` 방식을 사용하여 실패를 어설션함으로써 `v1.0`용으로 마이그레이션할 수 있습니다.
예를 들어, 아래와 같은 테스트:

```solidity
function testFail_IncrementAsNotOwner() public {
    vm.prank(address(0));
    upOnly.increment();
}
```

다음과 같이 다시 작성할 수 있습니다.

```solidity
function test_RevertWhen_CallerIsNotOwner() public {
    vm.expectRevert(Unauthorized.selector);
    vm.prank(address(0));
    upOnly.increment();
}
```

### 레거시 console.sol 서명 지원 제거 (Removed support for legacy console.sol signatures)

Foundry `v1.0`은 잘못된 ABI 인코딩을 사용하는 `console.sol` 선택자에 대한 지원을 제거합니다 - [#8910](https://github.com/foundry-rs/foundry/issues/8910) 참조. 이는 테스트 빌드 실패를 유발하여 기존 프로젝트에 영향을 줄 수 있으므로 그에 따라 업데이트해야 합니다. 예를 들어:

```solidity
console.log("testMisc", 42);
console.log(0);
```

다음과 같이 다시 작성해야 합니다.

```solidity
console.log("testMisc", uint256(42));
console.log(uint256(0));
console.logUint(0);
```

> ℹ️ **참고**
>
> 콘솔 로깅을 위한 새로운 서명을 사용하고 예기치 않은 동작을 피하려면 최신 `forge-std` 버전을 사용해야 합니다.

### 충돌하는 리매핑 무시 (Conflicting remappings are ignored)

Foundry `v1.0` 이전에는, `forge`가 하위 프로젝트의 리매핑을 고려하여 리매핑을 추론했습니다. 충돌하는 리매핑이 존재하는 경우 가장 긴/가장 구체적인 것이 우선순위를 가졌습니다. 이는 위험했는데, 하위 프로젝트를 추가하면 루트 프로젝트의 리매핑이 변경되지 않더라도 실행되는 코드를 완전히 변경할 수 있었기 때문입니다 - [#8910](https://github.com/foundry-rs/foundry/issues/9146) 참조.
`v1.0`에서는 동일한 리매핑이 루트 프로젝트와 가져온 의존성 모두에 정의된 경우 프로젝트 빌드가 실패합니다:

```toml
@openzeppelin/=lib/openzeppelin-contracts/contracts/
```

이 문제를 해결하려면 프로젝트 루트 리매핑을 `src` 컨텍스트에 추가해야 합니다:

```toml
src:@openzeppelin/=lib/openzeppelin-contracts/contracts/
```

### `forge coverage`에서 아티팩트가 유지되지 않음 (Artifacts not persisted on `forge coverage`)

이전 버전에서는 `forge coverage`가 경고 없이 아티팩트(정확한 소스 히트 맵을 제공하기 위해 최적화되지 않음)를 변경했습니다. 이는 혼란스러웠고 [#8840 코멘트](https://github.com/foundry-rs/foundry/issues/8840#issuecomment-2390792012)와 같은 원치 않는 상황으로 이어졌습니다. Foundry `v1.0`은 커버리지를 실행할 때 더 이상 아티팩트를 생성하지 않으므로 프로젝트는 변경 사항을 인지해야 합니다.

### 기타 (Other)

- `FORGE_SNAPSHOT_CHECK`는 부울 값이 필요합니다. `FORGE_SNAPSHOT_CHECK=true|false`를 사용하세요.
- `forge inspect --pretty` 플래그가 제거되었습니다. 테이블 보기를 위해 `forge inspect`를 사용하세요.
- `forge bind --ethers`가 제거되었습니다. `forge bind`를 사용하세요(기본값 `alloy`).
- `forge debug` 하위 명령이 제거되었습니다. `forge test --debug` 및 `forge script --debug`를 사용하세요.
- `cast etherscan-source` 하위 명령이 `cast source`로 대체되었습니다. 대체 블록 탐색기에는 추가 `explorer_url` 및 `explorer_api_url` 인수를 사용하세요.
- `foundryup`은 버전이 지정되지 않은 경우 stable을 설치합니다. nightly 버전을 설치하려면 `foundryup -i nightly`를 사용하세요.
