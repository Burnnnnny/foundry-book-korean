## Testing

`forge test`의 동작과 관련된 구성입니다.

**섹션 (Sections)**

- [일반 (General)](#general)
- [퍼즈 (Fuzz)](#fuzz)
- [불변성 (Invariant)](#invariant)

### General

##### `verbosity`

- Type: integer
- Default: 0
- Environment: `FOUNDRY_VERBOSITY` 또는 `DAPP_VERBOSITY`

테스트 중에 사용할 상세 수준(verbosity level)입니다.

- **Level 2 (`-vv`)**: 테스트 중에 발생한 로그도 표시됩니다.
- **Level 3 (`-vvv`)**: 실패한 테스트에 대한 스택 트레이스도 표시됩니다.
- **Level 4 (`-vvvv`)**: 모든 테스트에 대한 스택 트레이스와 실패한 테스트에 대한 설정(setup) 트레이스가 표시됩니다.
- **Level 5 (`-vvvvv`)**: 스택 트레이스와 설정 트레이스가 항상 표시됩니다.

##### `ffi`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_FFI` 또는 `DAPP_FFI`

`ffi` 치트코드 활성화 여부입니다.

**경고:** 이 치트코드를 활성화하면 테스트가 컴퓨터에서 임의의 프로그램을 실행할 수 있으므로 프로젝트에 보안상의 영향을 미칩니다.

##### `sender`

- Type: string (address)
- Default: 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38
- Environment: `FOUNDRY_SENDER` 또는 `DAPP_SENDER`

테스트에서의 `msg.sender` 값입니다.

##### `tx_origin`

- Type: string (address)
- Default: 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38
- Environment: `FOUNDRY_TX_ORIGIN` 또는 `DAPP_TX_ORIGIN`

테스트에서의 `tx.origin` 값입니다.

##### `initial_balance`

- Type: string (hexadecimal)
- Default: 0xffffffffffffffffffffffff
- Environment: `FOUNDRY_INITIAL_BALANCE` 또는 `DAPP_INITIAL_BALANCE`

테스트 컨트랙트의 초기 잔액(wei 단위, 16진수)입니다.

##### `block_number`

- Type: integer
- Default: 1
- Environment: `FOUNDRY_BLOCK_NUMBER` 또는 `DAPP_BLOCK_NUMBER`

테스트에서의 `block.number` 값입니다.

##### `chain_id`

- Type: integer
- Default: 31337
- Environment: `FOUNDRY_CHAIN_ID` 또는 `DAPP_CHAIN_ID`

테스트에서의 `chainid` 오퍼코드 값입니다.

##### `gas_limit`

- Type: integer 또는 string
- Default: 1073741824
- Environment: `FOUNDRY_GAS_LIMIT` 또는 `DAPP_GAS_LIMIT`

각 테스트 케이스의 가스 제한입니다.

> ℹ️ **참고**
>
> Forge 종속성의 제한으로 인해, 값을 문자열로 변경하지 않고는 기본값 이상으로 **가스 제한을 늘릴 수 없습니다**.
>
> 더 높은 가스 제한을 사용하려면 문자열을 사용하세요:

```toml
gas_limit = "9223372036854775807" # 64비트 정수로 제한됨
```

##### `gas_price`

- Type: integer
- Default: 0
- Environment: `FOUNDRY_GAS_PRICE` 또는 `DAPP_GAS_PRICE`

테스트에서의 가스 가격(wei 단위)입니다.

##### `block_base_fee_per_gas`

- Type: integer
- Default: 0
- Environment: `FOUNDRY_BLOCK_BASE_FEE_PER_GAS` 또는 `DAPP_BLOCK_BASE_FEE_PER_GAS`

테스트에서의 가스당 기본 수수료(wei 단위)입니다.

##### `block_coinbase`

- Type: string (address)
- Default: 0x0000000000000000000000000000000000000000
- Environment: `FOUNDRY_BLOCK_COINBASE` 또는 `DAPP_BLOCK_COINBASE`

테스트에서의 `block.coinbase` 값입니다.

##### `block_timestamp`

- Type: integer
- Default: 1
- Environment: `FOUNDRY_BLOCK_TIMESTAMP` 또는 `DAPP_BLOCK_TIMESTAMP`

테스트에서의 `block.timestamp` 값입니다.

##### `block_difficulty`

- Type: integer
- Default: 0
- Environment: `FOUNDRY_BLOCK_DIFFICULTY` 또는 `DAPP_BLOCK_DIFFICULTY`

테스트에서의 `block.difficulty` 값입니다.

##### `gas_reports`

- Type: array of strings (contract names)
- Default: ["*"]
- Environment: `FOUNDRY_GAS_REPORTS` 또는 `DAPP_GAS_REPORTS`

가스 보고서를 출력할 컨트랙트 목록입니다.

##### `no_storage_caching`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_NO_STORAGE_CACHING` 또는 `DAPP_NO_STORAGE_CACHING`

`true`로 설정하면 테스트의 RPC 엔드포인트에서 가져온 블록 데이터가 캐시되지 않습니다. 그렇지 않으면 데이터는 `$HOME/.foundry/cache/<chain id>/<block number>`에 캐시됩니다.

##### `[rpc_storage_caching]`

`[rpc_storage_caching]` 블록은 캐시되는 RPC 엔드포인트를 결정합니다.

###### `rpc_storage_caching.chains`

- Type: string 또는 array of strings (chain names)
- Default: all
- Environment: N/A

캐시되는 체인을 결정합니다. 기본적으로 모든 체인이 캐시됩니다.

유효한 값은 다음과 같습니다:

- "all"
- 체인 이름 목록, 예: `["optimism", "mainnet"]`

###### `rpc_storage_caching.endpoints`

- Type: string 또는 array of regex patterns (URL 매칭용)
- Default: remote
- Environment: N/A

캐시되는 RPC 엔드포인트를 결정합니다. 기본적으로 원격 엔드포인트만 캐시됩니다.

유효한 값은 다음과 같습니다:

- all
- remote (기본값)
- 정규식 패턴 목록, 예: `["localhost"]`

##### `eth_rpc_url`

- Type: string
- Default: 없음
- Environment: `FOUNDRY_ETH_RPC_URL` 또는 `DAPP_ETH_RPC_URL`

모든 RPC 호출에 사용해야 하는 RPC 서버의 URL입니다.

##### `etherscan_api_key`

- Type: string
- Default: 없음
- Environment: `FOUNDRY_ETHERSCAN_API_KEY` 또는 `DAPP_ETHERSCAN_API_KEY`

RPC 호출을 위한 Etherscan API 키입니다.

##### `match-test`

- Type: regex
- Default: 없음
- Environment: `FOUNDRY_MATCH_TEST` 또는 `DAPP_MATCH_TEST`

정규식과 일치하는 테스트 메서드만 실행합니다.
`forge test --match-test <TEST_PATTERN>`과 동일합니다.

##### `no-match-test`

- Type: regex
- Default: 없음
- Environment: `FOUNDRY_NO_MATCH_TEST` 또는 `DAPP_NO_MATCH_TEST`

정규식과 일치하지 않는 테스트 메서드만 실행합니다.
`forge test --no-match-test <TEST_PATTERN_INVERSE>`와 동일합니다.

##### `match-contract`

- Type: regex
- Default: 없음
- Environment: `FOUNDRY_MATCH_CONTRACT` 또는 `DAPP_MATCH_CONTRACT`

정규식과 일치하는 컨트랙트의 테스트 메서드만 실행합니다.
`forge test --match-contract <CONTRACT_PATTERN>`과 동일합니다.

##### `no-match-contract`

- Type: regex
- Default: 없음
- Environment: `FOUNDRY_NO_MATCH_CONTRACT` 또는 `DAPP_NO_MATCH_CONTRACT`

정규식과 일치하지 않는 컨트랙트의 테스트 메서드만 실행합니다.
`forge test --no-match-contract <CONTRACT_PATTERN_INVERSE>`와 동일합니다.

##### `match-path`

- Type: regex
- Default: 없음
- Environment: `FOUNDRY_MATCH_PATH` 또는 `DAPP_MATCH_PATH`

경로와 일치하는 파일의 테스트 메서드만 실행합니다.
`forge test --match-path <PATH_PATTERN>`과 동일합니다.

##### `no-match-path`

- Type: regex
- Default: 없음
- Environment: `FOUNDRY_NO_MATCH_PATH` 또는 `DAPP_NO_MATCH_PATH`

경로와 일치하지 않는 파일의 테스트 메서드만 실행합니다.
`forge test --no-match-path <PATH_PATTERN_INVERSE>`와 동일합니다.

##### `threads`

- Type: integer
- Default: 없음
- Environment: `FOUNDRY_THREADS`

사용할 스레드 수입니다.
설정하지 않거나 0이면 논리 코어 수를 지정합니다.

##### `show_progress`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_SHOW_PROGRESS`

테스트 실행 진행 상황을 표시할지 여부입니다.

##### `block_gas_limit`

- Type: integer
- Default: 없음
- Environment: `FOUNDRY_BLOCK_GAS_LIMIT` 또는 `DAPP_BLOCK_GAS_LIMIT`

EVM 실행 중의 `block.gaslimit` 값입니다.

##### `memory_limit`

- Type: integer
- Default: 33554432
- Environment: `FOUNDRY_MEMORY_LIMIT` 또는 `DAPP_MEMORY_LIMIT`

바이트 단위의 EVM 메모리 제한입니다.

##### `names`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_NAMES` 또는 `DAPP_NAMES`

컴파일된 컨트랙트 이름을 출력합니다.

##### `sizes`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_SIZES` 또는 `DAPP_SIZES`

컴파일된 컨트랙트 크기를 출력합니다.

##### `rpc_endpoints`

- Type: RPC 엔드포인트 테이블
- Default: 없음
- Environment: 없음

이 섹션은 프로필 외부에 존재하며 RPC 엔드포인트 테이블을 정의합니다. 여기서 키는 RPC 엔드포인트의 이름을 지정하고 값은 RPC 엔드포인트 자체입니다.

값은 유효한 RPC 엔드포인트이거나 환경 변수에 대한 참조(`${}`로 감싸짐)일 수 있습니다.

이러한 RPC 엔드포인트는 테스트 및 Solidity 스크립트에서 사용할 수 있습니다([`vm.rpc`](/reference/cheatcodes/rpc) 참조).

다음 예제는 `optimism`이라는 엔드포인트와 환경 변수 `RPC_MAINNET`을 참조하는 `mainnet`이라는 엔드포인트를 정의합니다:

```toml
[rpc_endpoints]
optimism = "https://optimism.alchemyapi.io/v2/..."
mainnet = "${RPC_MAINNET}"
```

##### `prompt_timeout`

- Type: integer
- Default: 120
- Environment: `FOUNDRY_PROMPT_TIMEOUT`

`vm.prompt`가 타임아웃으로 되돌려지기(revert) 전까지 대기하는 시간(초)입니다.

### Fuzz

`[fuzz]` 섹션에 대한 구성 값입니다.

##### `runs`

- Type: integer
- Default: 256
- Environment: `FOUNDRY_FUZZ_RUNS` 또는 `DAPP_FUZZ_RUNS`

각 퍼즈 테스트 케이스에 대해 수행할 퍼즈 실행 횟수입니다. 값이 높을수록 결과에 대한 신뢰도가 높아지지만 테스트 속도는 느려집니다.

##### `timeout`

- Type: integer
- Default: 없음
- Environment: `FOUNDRY_FUZZ_TIMEOUT`

퍼즈 테스트에 대한 선택적 타임아웃(초)입니다.

##### `fail_on_revert`

- Type: boolean
- Default: true
- Environment: `FOUNDRY_FUZZ_FAIL_ON_REVERT`

테스트 컨트랙트가 아닌 다른 컨트랙트에 대한 호출에서 리버트(revert)가 발생하면 퍼즈 테스트를 실패 처리합니다.

##### `max_test_rejects`

- Type: integer
- Default: 65536
- Environment: `FOUNDRY_FUZZ_MAX_TEST_REJECTS`

테스트 전체가 중단되기 전에 거부될 수 있는 결합된 입력의 최대 수입니다.
"전역" 필터는 전체 테스트 케이스에 적용됩니다. 테스트 케이스가 거부되면 전체가 재생성됩니다.

##### `seed`

- Type: string (hexadecimal)
- Default: 없음
- Environment: `FOUNDRY_FUZZ_SEED`

퍼징 RNG 알고리즘을 위한 선택적 시드입니다.

##### `dictionary_weight`

- Type: integer (0에서 100 사이)
- Default: 40
- Environment: `FOUNDRY_FUZZ_DICTIONARY_WEIGHT`

사전(dictionary)의 가중치입니다. 사전 가중치가 높을수록 퍼즈 입력이 `type(uint256).max`와 같은 경계 값이나 환경의 컨트랙트 주소와 같은 "흥미로운" 값으로 편향됩니다.

##### `include_storage`

- Type: boolean
- Default: true
- Environment: `FOUNDRY_FUZZ_INCLUDE_STORAGE`

스토리지의 값을 포함할지 여부를 나타내는 플래그입니다.

##### `include_push_bytes`

- Type: boolean
- Default: true
- Environment: `FOUNDRY_FUZZ_INCLUDE_PUSH_BYTES`

푸시 바이트 값을 포함할지 여부를 나타내는 플래그입니다.

##### `gas_report_samples`

- Type: integer
- Default: 256
- Environment: `FOUNDRY_FUZZ_GAS_REPORT_SAMPLES`

가스 보고서를 생성하는 데 사용할 실행 횟수입니다.

##### `failure_persist_dir`

- Type: string (path)
- Default: `./cache/fuzz`
- Environment: `FOUNDRY_FUZZ_FAILURE_PERSIST_DIR`

퍼즈 실패가 기록되고 재생되는 경로입니다.

##### `failure_persist_file`

- Type: string
- Default: `failures`
- Environment: `FOUNDRY_FUZZ_FAILURE_PERSIST_FILE`

퍼즈 실패를 기록할 파일의 이름입니다.

##### `show_logs`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_FUZZ_SHOW_LOGS`

퍼즈 테스트에서 콘솔 로그를 표시할지 여부를 나타내는 플래그입니다. 콘솔 로그 표시를 활성화하려면 `show_logs = true`로 설정하고 `forge test -vv`를 사용하거나 `verbosity >= 2`로 설정해야 합니다.

### Invariant

`[invariant]` 섹션에 대한 구성 값입니다.

> ℹ️ **참고**
>
> `[invariant]` 섹션에 대한 구성은 일반적인 구성 항목(`runs`, `seed`, `dictionary_weight` 등)에 대한 폴백 로직을 가집니다.
>
> - 항목이 어느 섹션에도 설정되지 않은 경우 기본값이 사용됩니다.
> - 항목이 `[fuzz]` 섹션에는 설정되어 있지만 `[invariant]` 섹션에는 설정되지 않은 경우, 이 값들은 자동으로 `[fuzz]` 섹션에 지정된 값으로 설정됩니다.
> - `default` 이외의 프로필의 경우:
>   - `[invariant]`(즉, `[profile.default.invariant]`) 섹션에 하나 이상의 항목이 설정된 경우, 기본값을 포함하여 `[invariant]` 섹션의 값이 사용됩니다.
>   - `[invariant]` 섹션에 항목이 설정되지 않았지만 `[fuzz]`(즉, `[profile.default.fuzz]`) 섹션에 항목이 있는 경우, `[fuzz]` 섹션의 값이 사용됩니다.
>   - 위의 경우 중 어느 것도 해당하지 않으면 기본값이 사용됩니다.

##### `runs`

- Type: integer
- Default: 256
- Environment: `FOUNDRY_INVARIANT_RUNS`

각 불변성 테스트 그룹에 대해 실행해야 하는 실행 횟수입니다. [fuzz.runs](#runs)도 참조하세요.

##### `depth`

- Type: integer
- Default: 500
- Environment: `FOUNDRY_INVARIANT_DEPTH`

한 번의 실행에서 불변성을 깨뜨리기 위해 시도되는 함수 호출의 횟수입니다.

##### `timeout`

- Type: integer
- Default: 없음
- Environment: `FOUNDRY_INVARIANT_TIMEOUT`

불변성 시간 기반 캠페인에 대한 선택적 타임아웃(초)입니다.

##### `fail_on_revert`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_INVARIANT_FAIL_ON_REVERT`

리버트가 발생하면 불변성 퍼징을 실패 처리합니다.

##### `call_override`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_INVARIANT_CALL_OVERRIDE`

불변성 테스트 실행 시 안전하지 않은 외부 호출을 재정의합니다. 예를 들어 재진입 확인을 수행할 때 유용합니다.

##### `dictionary_weight`

- Type: integer (0에서 100 사이)
- Default: 80
- Environment: `FOUNDRY_INVARIANT_DICTIONARY_WEIGHT`

사전의 가중치입니다. [fuzz.dictionary_weight](#dictionary_weight)도 참조하세요.

##### `include_storage`

- Type: boolean
- Default: true
- Environment: `FOUNDRY_FUZZ_INCLUDE_STORAGE`

스토리지의 값을 포함할지 여부를 나타내는 플래그입니다. [fuzz.include_storage](#include_storage)도 참조하세요.

##### `include_push_bytes`

- Type: boolean
- Default: true
- Environment: `FOUNDRY_FUZZ_INCLUDE_PUSH_BYTES`

푸시 바이트 값을 포함할지 여부를 나타내는 플래그입니다. [fuzz.include_push_bytes](#include_push_bytes)도 참조하세요.

##### `shrink_run_limit`

- Type: integer
- Default: 5000
- Environment: `FOUNDRY_INVARIANT_SHRINK_RUN_LIMIT`

실패한 시퀀스를 축소(shrink)하려고 시도하는 최대 횟수입니다. 0으로 설정하면 축소 프로세스가 비활성화됩니다.

##### `max_assume_rejects`

- Type: integer
- Default: 65536
- Environment: `FOUNDRY_INVARIANT_MAX_ASSUME_REJECTS`

단일 불변성 실행 중에 `vm.assume`을 통해 발생할 수 있는 최대 거부(rejects) 횟수입니다.

##### `gas_report_samples`

- Type: integer
- Default: 256
- Environment: `FOUNDRY_INVARIANT_GAS_REPORT_SAMPLES`

가스 보고서를 생성하는 데 사용할 실행 횟수입니다.

##### `failure_persist_dir`

- Type: string (path)
- Default: `./cache/invariant`
- Environment: `FOUNDRY_INVARIANT_FAILURE_PERSIST_DIR`

불변성 실패가 기록되고 재생되는 경로입니다.

##### `corpus_dir`

- Type: string (path)
- Default: 없음
- Environment: `FOUNDRY_INVARIANT_CORPUS_DIR`

불변성 코퍼스(corpus)가 저장되는 선택적 경로입니다. 커버리지 기반 퍼징 및 엣지 커버리지 지표를 활성화합니다.

##### `corpus_gzip`

- Type: boolean
- Default: true
- Environment: `FOUNDRY_INVARIANT_CORPUS_GZIP`

코퍼스가 gzip 파일 압축 및 압축 해제를 사용해야 하는지 여부를 나타내는 플래그입니다(`corpus_dir`이 구성된 경우에만 관련됨). `false`로 설정하면 코퍼스는 일반 json 파일로 유지됩니다.

##### `corpus_min_mutations`

- Type: integer
- Default: 5
- Environment: `FOUNDRY_INVARIANT_CORPUS_MIN_MUTATIONS`

메모리에서 플러시될 자격이 있는 것으로 표시되기까지의 코퍼스 변형(mutations) 횟수입니다(`corpus_dir`이 구성된 경우에만 관련됨).

##### `corpus_min_size`

- Type: integer
- Default: 0
- Environment: `FOUNDRY_INVARIANT_CORPUS_MIN_SIZE`

변형되고 메모리에서 방출되지 않는 최소 코퍼스 크기입니다(`corpus_dir`이 구성된 경우에만 관련됨).

##### `show_edge_coverage`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_INVARIANT_SHOW_EDGE_COVERAGE`

엣지 커버리지 지표를 수집하고 표시할지 여부를 나타내는 플래그입니다(`corpus_dir`이 구성된 경우 자동으로 활성화됨).

##### `show_metrics`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_INVARIANT_SHOW_METRICS`

테스트 보고서에 퍼징된 선택자(selectors) 지표를 수집하고 표시할지 여부를 나타내는 플래그입니다.

##### `show_solidity`

- Type: boolean
- Default: false
- Environment: `FOUNDRY_INVARIANT_SHOW_SOLIDITY`

반례(counterexamples)를 solidity 호출로 표시할지 여부를 나타내는 플래그입니다.
